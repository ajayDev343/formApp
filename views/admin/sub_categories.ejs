<% include  layout/header.ejs %>
<% include  layout/navbar.ejs %>
<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row">
      <div class="content-header-left col-md-8 col-12 mb-2">
        <h3 class="content-header-title mb-0 d-inline-block">Sub Categories</h3>

      </div>
    </div>
    <div class="content-body">
      <!-- Basic form layout section start -->
      <section id="basic-form-layouts">
        <div class="row match-height">
          <div class="col-md-12">
            <div class="card" style="height: auto;">
              <div class="card-header">
                
                <div class="heading-elements">
                  <ul class="list-inline mb-0">
                    <li>
                      <a data-action="collapse">
                        <i class="ft-minus"></i>
                      </a>
                    </li>
                    <li>
                      <a data-action="expand">
                        <i class="ft-maximize"></i>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="card-content collapse show">
                <div class="card-body">
<section id="basic-form-layouts">
                    <div class="row match-height">
                        <div class="col-md-4">
                            <div class="card" style="height: auto;">
                                <div class="card-header">
                                    <h4 class="card-title" id="basic-layout-form">Add Sub Category</h4>
                                    <a class="heading-elements-toggle">
                                        <i class="la la-ellipsis-v font-medium-3"></i>
                                    </a>
                                    
                                </div>
                                <div class="card-content collapse show">
                                    <div class="card-body">
                                        <form  id="category" enctype='multipart/form-data' method="post" action="addcategory">
                                    <input type="hidden" name="id" id="idd" >
                                    <div class="form-group">
                                       
                                    </div>
                                    <div class="form-group">
                                        <div class="form-line id_100" id="id_100" >
                                            <select name="cat_id" class="form-control" >
                                            <% for(let i in all_cat_data) { %>
                                              <option value="<%=all_cat_data[i].id%>" ><%=all_cat_data[i].name%></option>
                                              <% } %>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="form-line">
                                            <input type="text" id="catname" name="catname" class="form-control" placeholder="Name" required>
                                        </div>
                                    </div>
                                     <div class="form-group">
                                       <label>Image</label>
                                         <div class="image2">
                                              <img id="blah2" src="../images/img.jpg"  alt="User">                                                 
                                         </div>
                                    </div>
                                    <div class="form-group" style="display:none">
                                      <div class="form-line">
                                            <input type="file" id="profieimage" accept="images/*" name="image" class="form-control" placeholder="Image" >
                                        </div>
                                    </div>
                                 
                                     <div class="form-group">
                                            <input type="submit" id="savebtn" class="btn btn-primary m-t-15 waves-effect" value="Save">
                                    </div>
                            </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="card" style="height: auto;">
                                <div class="card-header">
                                    <h4 class="card-title" id="basic-layout-colored-form-control">Sub Categories</h4>
                                    <a class="heading-elements-toggle">
                                        <i class="la la-ellipsis-v font-medium-3"></i>
                                    </a>
                                    
                                </div>
                                <div class="card-content collapse show">
                                    <div class="card-body">
                                        <div class="table-responsive">                                            

                                        <table class="table table-bordered table-striped table-hover js-basic-example dataTable zero-configuration">
                                        <thead>
                                            <tr>
                                                <th>S.No</th>
                                                <th>Name</th>
                                                <th>Category</th>

                                                <th>Image</th>
                                                <th class="text-center">Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                         <tbody>
                                            <% for(let i in response) { %>
                                             <tr>
                                                <td><%=parseInt(i)+1%></td>
                                                <td><%=response[i].name%></td>
                                                <td><%=response[i].main_cat.name%></td>

                                                <td> <img src="<%=response[i].image%>" height="50px" width="50px">  </td>
                                                <td class="text-center">
                                                    <div class="switch">
                                                        <label><input class="changestatus switchery" data-size="sm" id="<%=response[i].id%>" table="category" type="checkbox" <%=(response[i].status==1) ? 'checked' : "" %> >
                                                            <span class="lever"></span></label>
                                                    </div>
                                                 </td>
                                                <td class="text-center">
                                                   <span class="dropdown">
                                                            <button id="btnSearchDrop12" type="button" class="btn btn-sm btn-icon btn-pure font-medium-2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                <i class="ft-more-vertical"></i>
                                                            </button>
                                                            <span aria-labelledby="btnSearchDrop12" class="dropdown-menu mt-1 dropdown-menu-right">
                                                            <a href="javascript:void(0);" id="<%=response[i].id%>" catename="<%=response[i].name%>" catemain="<%=response[i].main_cat.id%>" cateimage="<%=response[i].image%>"  class="dropdown-item edit waves-effect waves-block"><i class="ft-edit"> </i>View/Edit</a>
                                                             
                                                             <a href="javascript:void(0);" rel="<%=response[i].id%>" table="category" class=" dropdown-item delete waves-effect waves-block"><i class="ft-delete"> </i>Delete</a>
                                                         </span>
                                                     </span>
                                                    
                                                </td>
                                            </tr>
                                            <% } %>
                                         </tbody>
                                      </table>
                                    </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </section>

                   </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- // Basic form layout section end -->
      </div>
    </div>
  </div>
<% include  layout/footer.ejs %>
<script type="text/javascript">
   $("#pdf_file_show").hide();
  
 $(".changestatus").change(function(){
      var id= $(this).attr('id');
      var table= $(this).attr('table');
      var status=0;
       if($(this).prop("checked") == true){
           status=1;
        }
       else if($(this).prop("checked") == false){
           status=0;
       }
       var ajaxurl = 'cat_statuschange',
          data = { id: id, table: table,status: status };
          $.post(ajaxurl, data, function (response) {
          if(response>0)
          {

          }
       });
        
        
 });
$('.delete').click(function () {
     let _this = $(this);
    let id = $(this).attr("rel");
     let table = $(this).attr("table");
       swal({
       title: "Are you sure?",
       text: "Once deleted, you will not be able to recover this data!",
       icon: "warning",
       buttons: true,
       dangerMode: false,
     })
       .then((data) => {
         if (data) {
           $.ajax({
             url: "delete_cate",
             type: "post",
             data: { id: id, table: table },
             cache: false,
             success: function (response) {
                 swal("Proof! Your data has been deleted!", {
                 icon: "success",
               });
               setTimeout(() => {
                window.location.reload();
                },3000);
             }, error(error) {
               console.error(error);
             }

           });
         }
       });
   });
/*$('.edit').click(function () { 
   var id=$(this).attr('id');
   var name=$(this).attr('catename');
   var pdf_file=$(this).attr('pdf_file_');
   $("#pdf_file_show").show();
   $('#pdf_file_show').attr("href",pdf_file);

   $('#idd').val(id);
   $('#catname').val(name);
   $('#savebtn').val('Update');
   $('#blah2').attr("src","../images/category/"+image);
});*/
$('.edit').click(function () { 
   var id=$(this).attr('id');
   var name=$(this).attr('catename');
   var image=$(this).attr('cateimage');
   var catemain=$(this).attr('catemain');
   // alert(catemain);
   if(!image){
      image='../images/img.jpg';
   }
   $('#idd').val(id);
   $('#catname').val(name);
   $('select[name^="cat_id"] option[value="'+catemain+'"]').attr("selected","selected");

   // $("#id_100").val(catemain).change();

   $('#savebtn').val('Update');
   $('#blah2').attr("src",image);
});
$.validator.addMethod("cat", function (value, element) {
    return this.optional(element) || /^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z]*)*$/i.test(value);
  }, 'Please check the format');

$("#category").validate({
    rules: {
        catname: {
        required: true,
        maxlength:25,
        cat:true,
      }
    },
    messages: {
        catname: {
        required: "Name field is required.",
        maxlength: "Please enter only 25 characters"
      },
    }

  });
 $('#blah2').click(function(){
   $('#profieimage').click();
  });
</script>